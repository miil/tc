Virtual Disk, Версия 1.31 Final
  FS-плагин для программы Total Commander, позволяющий подключать образы дисков
  в качестве дополнительных виртуальных дисков в системе.

Автор плагина: Власов Константин, 2009 г.
Домашняя страница: http://flint-inc.ru/
E-mail:            support@flint_inc.ru

Драйвер основан на open-source проекте FileDisk: Bo Branten, 2009 г.
Домашняя страница: http://www.acc.umu.se/~bosse/
E-mail:            bosse@acc.umu.se


Описание
--------

Этот плагин позволяет подключать образы дисков как дополнительные диски в системе.
Плагин работает только в системах WinNT, начиная с Windows 2000 (32- и 64-битных).
При подключении образа в системе появляется новый логический диск с заранее указанной
буквой, содержимое которого представляет собой содержимое образа.

Доступны следующие три режима работы:
  1. HDD - эмуляция локального жёсткого диска. В этом режиме можно подключать образы
     отдельных разделов жёстких дисков, отформатированных в FAT или NTFS, а также образы
     дискет и флеш-дисков с файловой системой FAT.
  2. FDD - эмуляция флоппи-диска. В этом режиме можно подключать всё то же самое, что и в
     режиме HDD, за исключением NTFS-образов (Windows не позволяет работать с системой
     NTFS на дискетах).
  3. CD/DVD - эмуляция CD-привода (с точки зрения системы различия между CD и DVD нет).
     Этот режим используется для подключения образов CD- и DVD-дисков. Допускается формат
     ISO, а также в некоторых случаях - BIN и NRG. (К сожалению, точная информация о том,
     в каких случаях BIN и NRG подключаются, а в каких - нет, пока отсутствует.)

Также для режимов HDD и FDD можно использовать модификатор "Только чтение" - в этом случае
запись на виртуальный диск будет запрещена. Эмуляция CD-привода всегда выполняется в
режиме "Только чтение".


Установка
---------

Для установки плагина в первую очередь необходимо установить драйвер диска. Для этого
вызовите контекстное меню файла vd_filedisk.inf, находящегося в папке VD_Driver, и
выберите там команду "Установить" (в английской версии - "Install"). Система установит
драйвер vd_filedisk.sys и предложит перезагрузить компьютер. Без перезагрузки драйвер (а
следовательно, и плагин) работать не будет!

  Если у вас в контекстном меню INF-файла отсутствует команда "Установить", вы можете
  воспользоваться старым способом установки: скопировать вручную файл драйвера
  vd_filedisk.sys в каталог Windows\System32\Drivers\ , затем импортировать в реестр
  файл vd_filedisk.reg (двойным щелчком по нему) и перезагрузить компьютер.

ВНИМАНИЕ!!!
В 64-битных системах все манипуляции по установке драйвера необходимо производить только
из Проводника Windows! Если выполнить их из Total Commander, драйвер не будет установлен!
Это связано с тем, что TC - 32-битное приложение, работающее в 64-битных Windows в режиме
эмуляции 32-битного окружения.
Помимо этого, 64-битные системы, начиная с Windows Vista, разрешают работу только с
подписанными драйверами. Поскольку подписывание драйверов - процедура довольно
дорогостоящая, да к тому же доступная исключительно юридическим лицам, мой драйвер
поставляется неподписанным. Чтобы работать с ним, необходимо при загрузке системы нажимать
F8 и выбирать пункт "Отключение обязательной проверки подписи драйверов" ("Disable Driver
Signature Enforcement"). Все претензии - к Microsoft.

После этого можно устанавливать собственно файл VirtualDisk.wfx обычным способом: зайти в
диалог настроек TC, выбрать там пункт "Операции", нажать кнопку "FS-плагины", в
появившемся диалоге нажать "Добавить" и выбрать WFX-файл плагина. Можно также
воспользоваться режимом автоустановки, появившейся в Total Commander 6.50: в этом случае
плагин установится автоматически, когда вы зайдёте в архив с плагином.
Но учтите, что драйвер в любом случае необходимо устанавливать вручную, как описано выше!


Работа с плагином
-----------------

После установки в TotalCommander'е в сетевом окружении появляется дополнительная папка с
названием "Virtual Disks". При заходе в эту папку выводится список файлов-образов.
Изначально этот список пустой. Добавлять образы можно простым копированием файла в эту
папку, при этом сам файл физически никуда не перемещается, запоминается только ссылка на
него. Эти ссылки можно удалить из списка обычным удалением, при этом исходный файл не
трогается.

Для настройки параметров образа нужно выбрать пункт "Свойства" из контекстного меню, или
просто нажать Enter или Alt+Enter. Появится диалоговое окно, в котором указан полный путь
к исходному файлу-образу и его текущий статус (подключён/не подключён). В этом окне можно
выбрать букву диска для подключения образа и режим (HDD/FDD/CD).
Для подключения диска нужно нажать кнопку "Подключить". Если диск уже подключён, то вместо
неё находится кнопка "Отключить".

При перезагрузке компьютера все подключённые образы становятся отключёнными. Опция
"Восстанавливать при перезагрузке" позволяет автоматически переподключить нужные диски при
загрузке компьютера: если на момент перезагрузки образ был подключён, он подключается, в
противном случае он остаётся неподключённым.
Если в процессе этого автоматического переподключения возникают какие-то ошибки, они
записываются в файл журнала VirtualDisk.log, находящийся в папке плагина.


ВАЖНЫЕ ОСОБЕННОСТИ при работе с плагином:
-----------------------------------------

1. Не стоит подключать/отключать диски в разных копиях TotalCommander'а. Может получиться
   так, что образ подключён, а в другой копии Тотала говорится, что отключён, или
   наоборот. На данный момент многие подобные ситуации автоматически разрешаются, но всё
   же могут появиться пересечения. Для любителей же экспериментов у меня есть просьба:
   потестировать плагин в работе с несколькими копиями TC, чтобы найти такие нехорошие
   ситуации - я сам не могу перебрать все варианты. На случай таких конфликтов в диалоге
   свойств предусмотрена кнопка "Переключить" - она просто меняет программный флажок
   подключения, не производя никаких реальных действий с образами.
2. CD-образы можно подключать только в режиме CD, FAT-образы - в режимах HDD и FDD, а
   NTFS-образы - только в режиме HDD. Если эти ограничения не соблюдены, то образ
   подключится, виртуальный диск появится в системе, но при обращении к нему будет выдана
   ошибка, что диск неформатирован.
3. Подключённый диск не виден программами, которые получают список дисков из списка
   системных устройств. Это связано с тем, что новый диск не является системным
   устройством, а виден только как логический диск. В будущих версиях я постараюсь
   добавить создание соответствующего системного устройства.


ЧаВо (ЧАсто задаваемые ВОпросы)
-------------------------------

В. Я установил плагин, пытаюсь подключить образ, и мне выдаётся ошибка:
     Ошибка при создании виртуального диска!
     Возможно, не установлен драйвер.
О. Для корректной работы плагина требуется установить драйвер, причём это необходимо
   сделать вручную, автоматическая установка в TC устанавливает только плагин, но не
   драйвер! Как устанавливать драйвер, подробно описано выше, в разделе "Установка".

В. При попытке подключения образа выдаётся ошибка:
     Ошибка при создании виртуального диска!
     Подключено уже слишком много устройств данного типа.
О. Драйвер по умолчанию позволяет подключать только по 4 устройства каждого типа (т.е. 4
   эмулятора FDD, 4 - HDD и 4 - CD/DVD). Если вам требуется большее количество, можно
   увеличить этот параметр в реестре, ключ:
     [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\VD_FileDisk\Parameters]
     NumberOfDevices=dword:00000004
   После этого необходимо перезагрузить компьютер.

В. При подключении образа новый диск создаётся, но когда я пытаюсь его открыть, выдаётся
   ошибка.
О. Это означает, что формат образа не поддерживается плагином (а точнее - драйвером).
   Убедитесь, что вы не подключили случайно образ CD/DVD-диска как жёсткий диск или
   наоборот. Также имейте в виду, что набор поддерживаемых форматов на данный момент
   крайне ограничен (подробнее см. выше, в разделе "Описание").

В. У меня в Windows x64 плагин не подключает образы. В чём проблема?
О. Возможно, вы неправильно установили драйвер. В 64-битных системах драйвер необходимо
   устанавливать из Проводника Windows, а не из самого Total Commander, поскольку TC -
   32-битное приложение, а Windows x64 для таких приложений подменяет системные папки и
   ключи реестра; в результате при установке копирование производится не в ту папку, в
   которую должно производиться, и драйвер оказывается не установленным.
   Кроме того, если у вас Windows Vista или новее, драйвер не будет загружен, если вы не
   выберете при загрузке системы пункт, разрешающий работу с неподписанными драйверами
   (подробности см. выше в разделе "Установка").


На всякий случай напишу это предупреждение:
-------------------------------------------

Программа работает с низкоуровневыми функциями Windows, что небезопасно. Я не могу
гарантировать, что программа работает абсолютно правильно и бессбойно (положение
усугубляется тем, что область программирования драйверов для меня пока малоизученная).
Посему распространяю плагин "как есть", не прилагая никаких гарантий и обещаний о
правильности работы. Используйте её на свой страх и риск.
Хочу только уточнить: по мере своих сил и возможностей я буду стараться исправлять все
найденные ошибки и недочёты. В конце концов, так как я сам пользуюсь этим плагином, я
заинтересован в его правильной работе...
